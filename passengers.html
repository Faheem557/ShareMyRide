<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <meta charset="utf-8" />
        <title> | Hyper - Responsive Bootstrap 5 Admin Dashboard</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
        <meta content="Coderthemes" name="author" />
        App favicon
        <link rel="shortcut icon" href="assets/images/favicon.ico"> -->

    <meta charset="utf-8" />
    <title>Share my ride - Admin & Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
    <!-- add font awsome  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

</head>

<body id="body" class="dark-sidebar">
    <!-- leftbar-tab-menu -->
    <div class="left-sidebar">
        <!-- LOGO -->
        <div class="brand">
            <a href="index.html" class="logo">
                <span>
                    <img src="assets/images/logo-sm.png" alt="logo-small" class="logo-sm">
                </span>
                <span>
                    <img src="assets/images/logo.png" alt="logo-large" class="logo-lg logo-light">
                    <img src="assets/images/logo-dark.png" alt="logo-large" class="logo-lg logo-dark">
                </span>
            </a>
        </div>
        <div class="sidebar-user-pro media border-end">
            <div class="position-relative mx-auto">
                <img src="assets/images/users/user-4.jpg" alt="user" class="rounded-circle thumb-md">
                <span class="online-icon position-absolute end-0"><i class="mdi mdi-record text-success"></i></span>
            </div>
            <div class="media-body ms-2 user-detail align-self-center">
                <h5 class="font-14 m-0 fw-bold">Mr. Michael Hill </h5>
                <p class="opacity-50 mb-0">michael.hill@exemple.com</p>
            </div>
        </div>

        <!-- Tab panes -->

        <!--end logo-->
        <div class="menu-content h-100" data-simplebar>
            <div class="menu-body navbar-vertical">
                <div class="collapse navbar-collapse tab-content" id="sidebarCollapse">
                    <!-- Navigation -->
                    <ul class="navbar-nav tab-pane active" id="Main" role="tabpanel">
                        <!-- <li class="menu-label mt-0 text-primary font-12 fw-semibold">M<span>ain</span><br><span
                                class="font-10 text-secondary fw-normal">Unique Dashboard</span></li> -->

                        <li class="nav-item">
                            <a class="nav-link" href="passengers.html"><i
                                    class="ti ti-users menu-icon"></i><span>Passengers</span></a>
                        </li><!--end nav-item-->
                        <li class="nav-item">
                            <a class="nav-link" href="Drivers.html"><i
                                    class="ti ti-users menu-icon"></i><span>drivers</span></a>
                        </li><!--end nav-item-->
                        <li class="nav-item">
                            <a class="nav-link" href="Settings.html"><i
                                    class="ti ti-calendar menu-icon"></i><span>settings</span></a>
                        </li><!--end nav-item-->
                        <!-- <li class="nav-item">
                            <a class="nav-link" href="apps-invoice.html"><i
                                    class="ti ti-file-invoice menu-icon"></i><span>Invoice</span></a>
                        </li>end nav-item -->
                    </ul>
                    <ul class="navbar-nav tab-pane" id="Extra" role="tabpanel">
                        <li>
                            <div class="update-msg text-center position-relative">
                                <button type="button" class="btn-close position-absolute end-0 me-2"
                                    aria-label="Close"></button>
                                <img src="assets/images/speaker-light.png" alt="" class="" height="110">
                                <h5 class="mt-0">Mannat Themes</h5>
                                <p class="mb-3">We Design and Develop Clean and High Quality Web Applications</p>
                                <a href="javascript: void(0);" class="btn btn-outline-warning btn-sm">Upgrade your
                                    plan</a>
                            </div>
                        </li>
                    </ul><!--end navbar-nav--->
                </div><!--end sidebarCollapse-->
            </div>
        </div>
    </div>
    <!-- end left-sidenav-->
    <!-- end leftbar-menu-->

    <!-- Top Bar Start -->
    <!-- Top Bar Start -->
    <div class="topbar">
        <!-- Navbar -->
        <nav class="navbar-custom" id="navbar-custom">
            <ul class="list-unstyled topbar-nav float-end mb-0">
                <li class="dropdown">
                    <a class="nav-link dropdown-toggle nav-user" data-bs-toggle="dropdown" href="#" role="button"
                        aria-haspopup="false" aria-expanded="false">
                        <div class="d-flex align-items-center">
                            <img src="assets/images/users/user-4.jpg" alt="profile-user"
                                class="rounded-circle me-2 thumb-sm" />
                            <div>
                                <small class="d-none d-md-block font-11">Admin</small>
                                <span class="d-none d-md-block fw-semibold font-12">Maria Gibson <i
                                        class="mdi mdi-chevron-down"></i></span>
                            </div>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end">
                        <a class="dropdown-item" href="#"><i class="ti ti-user font-16 me-1 align-text-bottom"></i>
                            Profile</a>
                        <a class="dropdown-item" href="#"><i class="ti ti-settings font-16 me-1 align-text-bottom"></i>
                            Settings</a>
                        <div class="dropdown-divider mb-0"></div>
                        <a class="dropdown-item" href="#"><i class="ti ti-power font-16 me-1 align-text-bottom"></i>
                            Logout</a>
                    </div>
                </li><!--end topbar-profile-->
                <li class="notification-list">
                    <!-- <a class="nav-link arrow-none nav-icon offcanvas-btn" href="#" data-bs-toggle="offcanvas"
                        data-bs-target="#Appearance" role="button" aria-controls="Rightbar">
                        <i class="ti ti-settings ti-spin"></i>
                    </a> -->
                </li>
            </ul><!--end topbar-nav-->

            <ul class="list-unstyled topbar-nav mb-0">
                <li>
                    <button class="nav-link button-menu-mobile nav-icon" id="togglemenu">
                        <i class="ti ti-menu-2"></i>
                    </button>
                </li>
                <li class="hide-phone app-search">
                    <form role="search" action="#" method="get">
                        <input type="search" name="search" class="form-control top-search mb-0"
                            placeholder="Type text...">
                        <button type="submit"><i class="ti ti-search"></i></button>
                    </form>
                </li>
            </ul>
        </nav>
        <!-- end navbar-->
    </div>
    <!-- Top Bar End -->
    <!-- Top Bar End -->

    <div class="page-wrapper">

        <!-- Page Content-->
        <div class="page-content-tab">

            <div class="container-fluid">
                <!-- Page-Title -->
                <div class="row">
                    <div class="col-lg-3 position-sticky top-10 end-0 mt-3">
                        <div class="toast align-items-center text-white bg-success border-0  p-2 " id="Msg" role="alert"
                            aria-live="assertive" aria-atomic="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <span id="Message"></span>
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                    data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="page-title-box">
                            <div class="float-end">
                                <ol class="breadcrumb">
                                    <!-- <li class="breadcrumb-item"><a href="#">Unikit</a>
                                    </li> -->
                                    <!--end nav-item-->
                                    <!-- <li class="breadcrumb-item"><a href="#">Dashboard</a>
                                    </li> -->
                                    <!--end nav-item-->
                                    <!-- <li class="breadcrumb-item active">Analytics</li> -->
                                </ol>
                            </div>
                            <h4 class="page-title">Passenger List</h4>
                        </div><!--end page-title-box-->
                    </div><!--end col-->
                </div>
                <!-- end page title end breadcrumb -->

                <div class="row">
                    <!-- Button trigger modal -->

                    <div class="col-sm-12 d-flex justify-content-end align-items-center">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            data-bs-target="#AddPassengerModel">
                            Add Passenger
                        </button>
                    </div>
                    <div class="row">
                        <table class="table table-hover table-bordered table-striped" id="datatable_2"
                            style="text-align: center;">
                            <thead class="" style="color: black;">
                                <tr>
                                    <th scope="col" style="color: black;font-weight: bold;">S.No</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Name</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Email</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Password</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Phone</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Address</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Date</th>
                                    <th scope="col" style="color: black;font-weight: bold;">Action</th>  
                                </tr>
                            </thead>
                            <tbody id="PassengerTbl">
                                <!-- Add table rows and data here -->
                            </tbody>
                        </table>
                    </div>
                </div><!--end row-->
            </div><!-- container -->
            <!--Start Footer-->
            <!-- Footer Start -->

            <!-- Add Passenger Modal   -->
            <div class="modal fade" id="AddPassengerModel" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Add Passenger Form</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <form class="row  needs-validation" novalidate>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="Name" required>
                                        <div id="NameCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="email" class="form-label">Email</label>
                                        <input class="form-control" type="text" id="email" placeholder="Enter email">
                                        <small id="EmailCheck"></small>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Phone Number</label>
                                        <input type="text" class="form-control" id="PhoneNo" required>
                                        <div id="PhoneCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="Password" required>
                                        <div id="PasswordCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Confirm Password</label>
                                        <input type="password" class="form-control" id="CPassword" required>
                                        <div id="PasswordConfirmCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Address</label>
                                        <input type="text" class="form-control" id="Address" required>
                                        <div id="AddressCheck"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="AddPassengerBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Update Passenger Model -->
            <div class="modal fade" id="UpdatePassengerModel" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Add Passenger Form</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <form class="row  needs-validation" novalidate>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="UpdateName" required>
                                        <div id="UpdateNameCheck" class="invalid-feedback"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="email" class="form-label">Email</label>
                                        <input class="form-control" type="text" id="Updateemail"
                                            placeholder="Enter email">
                                        <small id="UpdateEmailCheck"></small>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Phone Number</label>
                                        <input type="text" class="form-control" id="UpdatePhoneNo" required>
                                        <div id="UpdatePhoneCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="UpdatePassword" required>
                                        <div id="UpdatePasswordCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Confirm Password</label>
                                        <input type="password" class="form-control" id="UpdateCPassword" required>
                                        <div id="UpdatePasswordConfirmCheck"></div>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <label for="validationCustom01" class="form-label">Address</label>
                                        <input type="text" class="form-control" id="UpdateAddress" required>
                                        <div id="UpdateAddressCheck"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="UpdatePassengerBtn">Update</button>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="footer text-center text-sm-start">
                &copy;
                <script>
                    document.write(new Date().getFullYear())
                </script>
                Share My Ride <span class="text-muted d-none d-sm-inline-block float-end">Crafted with <i
                        class="mdi mdi-heart text-danger"></i>Usman,Hamza and Junaid </span>
            </footer>
            <!-- end Footer -->
            <!--end footer-->
        </div>
        <!-- end page content -->
    </div>
    <!-- end page-wrapper -->

    <!-- Javascript  -->
    <script src="assets/pages/analytics-index.init.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-database-compat.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>


    <!-- App js -->
    <script src="assets/js/app.js"></script>
    <script>
        const firebaseConfig = {
            databaseURL: "https://share-my-ride-5b357-default-rtdb.firebaseio.com/"
        }
        firebase.initializeApp(firebaseConfig)
        const database = firebase.database()

        // fetch data
        var fetchedData = database.ref('users/')

        fetchedData.on('value', (snapshot) => {
            $("#PassengerTbl").empty();
            var data = snapshot.val()
            var i = 0;
            for (var key in data) {
                i++;
                var value = data[key]
                // console.log(value.name);
                $("#PassengerTbl").append(
                    "<tr>" +
                    "<td>" + i + "</td>" +
                    "<td>" + value.name + "</td>" +
                    "<td>" + value.email + "</td>" +
                    "<td>" + value.password + "</td>" +
                    "<td>" + value.phone_number + "</td>" +
                    "<td>" + value.address + "</td>" +
                    "<td>" + value.Create_at + "</td>" +
                    "<td><button type='button' class='EditPassenger btn btn-primary btn-sm'" +
                    " data-bs-toggle='modal' data-bs-target='#UpdatePassengerModel' data-value='" +
                    encodeURIComponent(key) +
                    "' id='EditBookStock'><i class='fas fa-edit'></i></button></td>" +
                    "</tr>"
                );
                // you can also use object keys
                // console.log(key);
            }
        })

        //Write a function to clear all vaildation messages
        function clearValidation() {
            $("#NameCheck").removeClass('text-danger').html("");
            $("#EmailCheck").removeClass('text-danger').html("");
            $("#PhoneCheck").removeClass('text-danger').html("");
            $("#PasswordCheck").removeClass('text-danger').html("");
            $("#PasswordConfirmCheck").removeClass('text-danger').html("");
            $("#AddressCheck").removeClass('text-danger').html("");
            //Now use update function to clear all validation messages
            $("#UpdateNameCheck").removeClass('text-danger').html("");
            $("#UpdateEmailCheck").removeClass('text-danger').html("");
            $("#UpdatePhoneCheck").removeClass('text-danger').html("");
            $("#UpdatePasswordCheck").removeClass('text-danger').html("");
            $("#UpdatePasswordConfirmCheck").removeClass('text-danger').html("");
            $("#UpdateAddressCheck").removeClass('text-danger').html("");
        }
        // Add Passenger
        $("#AddPassengerBtn").click(function () {
            var name = $("#Name").val();
            var email = $("#email").val();
            var phone = $("#PhoneNo").val();
            var password = $("#Password").val();
            var address = $("#Address").val();
            var cpassword = $("#CPassword").val();
            //Date
            var currentDate = new Date();
            var day = currentDate.getDate();
            var month = currentDate.getMonth() + 1;
            var year = currentDate.getFullYear();
            var FullDate = day + "-" + month + "-" + year;



            // Validation
            if (name.trim() === "") {
                $("#NameCheck").addClass('text-danger').html("Name is required");
                return false;
            }
            if (email === "") {
                $("#EmailCheck").addClass('text-danger').html("Email is required");
                return false;
            }
            if (phone === "") {
                $("#PhoneCheck").addClass('text-danger').html("Phone is required");
                return false;
            }
            if (password === "") {
                $("#PasswordCheck").addClass('text-danger').html("Password is required");
                return false;
            }
            if (password.length < 6) {

                $("#PasswordCheck").addClass('text-danger').html("Password Must Have 6 Digits");
                return false;
            }
            if (cpassword !== password) {
                $("#PasswordConfirmCheck").addClass('text-danger').html("Password and Confirm Password must be same");
                return false;
            }
            if (address === "") {
                $("#AddressCheck").addClass('text-danger').html("Address is required");
                return false;
            }
            if (password !== cpassword) {
                $("#PasswordConfirmCheck").addClass('text-danger').html("Password and Confirm Password must be same");
                return false;
            }

            // Encode email to make it suitable for use as a Firebase path
            var encodedEmail = encodeURIComponent(email);

            // Data to be saved
            var data = {
                name: name,
                email: email,
                phone_number: phone,
                password: password,
                address: address,
                Create_at:FullDate
            };

            // Save data to Firebase
            firebase.database().ref('users/').push(data)
                .then(function () {
                    // Close modal after successful save
                    $("#AddPassengerModel").modal('hide');
                    // Log success message
                    console.log("Data successfully Save to Firebase");
                    $('#Message').html('Data Save Successfully');
                    $('#Msg').addClass("bg-success").removeClass("bg-danger").toast('show')

                    //empty form fields
                    $("#Name").val('');
                    $("#email").val('');
                    $("#PhoneNo").val('');
                    $("#Password").val('');
                    $("#Address").val('');
                    $("#CPassword").val('');
                    clearValidation();
                })
                .catch(function (error) {
                    console.error("Error saving data: ", error);
                    $('#Message').html("Error saving data: " + error);
                    $('#Msg').addClass("bg-danger").removeClass("bg-success").toast('show')
                });
        });
        var keys;
        //Get Data From Firebase for Update
        $(document).on('click', '.EditPassenger', function () {
            var keys = $(this).data('value');
            // Get Data From Firebase for Update

            var key = $(this).data('value');
            // Create hidden element and store key in it
            var hiddenElement = document.createElement("input");
            hiddenElement.setAttribute("type", "hidden");
            hiddenElement.setAttribute("id", "UpdateKey");
            hiddenElement.setAttribute("value", key);
            document.body.appendChild(hiddenElement);
            clearValidation();


            database.ref('users/' + keys).once('value', function (snapshot) {
                var data = snapshot.val();
                $("#UpdateName").val(data.name);
                $("#Updateemail").val(data.email);
                $("#UpdatePhoneNo").val(data.phone_number);
                $("#UpdatePassword").val(data.password);
                $("#UpdateAddress").val(data.address);
                $("#UpdateCPassword").val(data.password);
                $("#UpdatePassengerBtn").attr('data-value', key);
            });
        });


        // Update Passenger Records
        $("#UpdatePassengerBtn").on('click', function () {
            var name = $("#UpdateName").val();
            var email = $("#Updateemail").val();
            var phone = $("#UpdatePhoneNo").val();
            var password = $("#UpdatePassword").val();
            var address = $("#UpdateAddress").val();
            var cpassword = $("#UpdateCPassword").val();
            //get current date
            var currentDate = new Date();
            var day = currentDate.getDate();
            var month = currentDate.getMonth() + 1;
            var year = currentDate.getFullYear();
            var FullDate = day + "-" + month + "-" + year;


            // Validation
            if (name.trim() === "") {
                $("#UpdateNameCheck").addClass('text-danger').html("Name is required");
                return false;
            }
            if (email.trim() === "") {
                $("#UpdateEmailCheck").addClass('text-danger').html("Email is required");
                return false;
            }
            if (phone.trim() === "") {
                $("#UpdatePhoneCheck").addClass('text-danger').html("Phone is required");
                return false;
            }
            if (password.trim() === "") {
                $("#UpdatePasswordCheck").addClass('text-danger').html("Password is required");
                return false;
            }
            if (cpassword !== password) {
                $("#UpdatePasswordConfirmCheck").addClass('text-danger').html("Password and Confirm Password must be same");
                return false;
            }
            if (address === "") {
                $("#UpdateAddressCheck").addClass('text-danger').html("Address is required");
                return false;
            }
            if (password !== cpassword) {
                $("#UpdatePasswordConfirmCheck").addClass('text-danger').html("Password and Confirm Password must be same");
                return false;
            }
            // var key = $(this).data('value');
            var key = $("#UpdateKey").val();


            var data = {
                name: name,
                email: email,
                phone_number: phone,
                password: password,
                address: address,
                Create_at:FullDate,
            };

            firebase.database().ref('users/' + key).update(data)
                .then(function () {
                    // Close modal after successful save
                    $("#UpdatePassengerModel").modal('hide');
                    // Log success message
                    // console.log("Data successfully saved to Firebase");
                    $('#Message').html('Data Updated Successfully');
                    $('#Msg').addClass("bg-success").removeClass("bg-danger").toast('show')
                    //Empty form fields
                    $("#Name").val('');
                    $("#email").val('');
                    $("#PhoneNo").val('');
                    $("#Password").val('');
                    $("#Address").val('');
                    $("#CPassword").val('');
                    clearValidation();
                })
                .catch(function (error) {
                    // Log error message
                    console.error("Error saving data: ", error);
                });
        });
    </script>
</body>
<!--end body-->

</html>